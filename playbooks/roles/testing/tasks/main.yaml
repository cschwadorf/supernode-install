---
# Test supernode after installlation

# Test if GRE tunnel is up and running

- name: Collect only facts returned by facter
  setup:

- name: "Are the GRE Tunnel endpoints reachable via IPv4?"
  shell: "ping -4 -c 1 {{ gre[item].daddress }}"
  ignore_errors: True
  loop: "{{ gre | list }}"


- name: "Are the GRE Tunnel endpoints reachable via IPv6?"
  shell: "ping -6 -c 1 {{ gre[item].dinet6 }}"
  ignore_errors: True
  loop: "{{ gre | list }}"

# Test external domains are working
# URL must end with a dot or freifunk-rhein-sieg.net will be added.

- name: "Are other domains reachable?"
  shell: "ping -c 1 {{ item }}"
  ignore_errors: True
  loop: 
    - 't-online.de.'
    - 'byggvir.de.'
